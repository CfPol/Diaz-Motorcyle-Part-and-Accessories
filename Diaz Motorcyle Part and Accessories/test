Imports MySql.Data.MySqlClient

Module Module1
    Public cn As New MySqlConnection
    Public cm As New MySqlCommand
    Public cm1 As New MySqlCommand
    Public dr As MySqlDataReader
    Public dt As New DataTable
    Public dt1 As New DataTable
    Public da As MySqlDataAdapter
    Public da1 As MySqlDataAdapter
    Public ds As DataSet

    Public Function ConnectToDB() As MySqlConnection
        Dim connection As New MySqlConnection
        Try
            connection.ConnectionString = "server=localhost; user id=root; password=; database=exam"
            connection.Open()
            Return connection
        Catch ex As Exception
            Return Nothing
        End Try
    End Function
End Module

Public Class Form1

    Private Sub Form1_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        ' Load ComboBox data
        LoadComboBoxData("SELECT Course_name FROM courses", course_cbo)
        LoadComboBoxData("SELECT Stud_name FROM students", name_cbo)
        LoadComboBoxData("SELECT Subject_name FROM subjects", sub_cbo)
        LoadComboBoxData("SELECT Lecturer_name FROM lecturers", lecturer_cbo)
    End Sub

    Private Sub LoadComboBoxData(query As String, comboBox As ComboBox)
        Dim connection As MySqlConnection = Module1.ConnectToDB()
        Using command As New MySqlCommand(query, connection)
            Using reader As MySqlDataReader = command.ExecuteReader()
                comboBox.Items.Clear()
                While reader.Read()
                    comboBox.Items.Add(reader(0).ToString())
                End While
            End Using
        End Using
    End Sub

    Private Sub add_btn_Click(sender As Object, e As EventArgs) Handles add_btn.Click
        ' Add selected subject and lecturer to DataGridView
        Dim subject As String = sub_cbo.SelectedItem.ToString()
        Dim lecturer As String = lecturer_cbo.SelectedItem.ToString()
        
        DataGridView1.Rows.Add(subject, lecturer)
    End Sub

    Private Sub save_btn_Click(sender As Object, e As EventArgs) Handles save_btn.Click
        ' Insert DataGridView rows into student_subject table
        Dim connection As MySqlConnection = Module1.ConnectToDB()
        Dim studentName As String = name_cbo.SelectedItem.ToString()

        For Each row As DataGridViewRow In DataGridView1.Rows
            If Not row.IsNewRow Then
                Dim subject As String = row.Cells(0).Value.ToString()
                Dim lecturer As String = row.Cells(1).Value.ToString()

                Dim query As String = "INSERT INTO student_subject (Student_name, Subject_name, Lecturer_name) VALUES (@StudentName, @SubjectName, @LecturerName)"
                Using command As New MySqlCommand(query, connection)
                    command.Parameters.AddWithValue("@StudentName", studentName)
                    command.Parameters.AddWithValue("@SubjectName", subject)
                    command.Parameters.AddWithValue("@LecturerName", lecturer)
                    command.ExecuteNonQuery()
                End Using
            End If
        Next
    End Sub

End Class